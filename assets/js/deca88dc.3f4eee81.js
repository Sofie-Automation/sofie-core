"use strict";(self.webpackChunksofie_documentation=self.webpackChunksofie_documentation||[]).push([[1021],{95905:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"user-guide/installation/installing-package-manager","title":"Installing Package Manager","description":"Prerequisites","source":"@site/docs/user-guide/installation/installing-package-manager.md","sourceDirName":"user-guide/installation","slug":"/user-guide/installation/installing-package-manager","permalink":"/sofie-core/docs/user-guide/installation/installing-package-manager","draft":false,"unlisted":false,"editUrl":"https://github.com/Sofie-Automation/sofie-core/edit/main/packages/documentation/docs/user-guide/installation/installing-package-manager.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"userGuide","previous":{"title":"Configuring Vision Mixers","permalink":"/sofie-core/docs/user-guide/installation/installing-connections-and-additional-hardware/vision-mixers"},"next":{"title":"Sofie Rundown Editor","permalink":"/sofie-core/docs/user-guide/installation/rundown-editor"}}');var t=a(62540),s=a(43023);const o={sidebar_position:7},r="Installing Package Manager",c={},l=[{value:"Prerequisites",id:"prerequisites",level:3},{value:"Installation For Development (Quick Start)",id:"installation-for-development-quick-start",level:2},{value:"Installation In Production",id:"installation-in-production",level:2},{value:"Simple Setup",id:"simple-setup",level:3},{value:"Distributed Setup",id:"distributed-setup",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Separate HTTP proxy server",id:"separate-http-proxy-server",level:3},{value:"Usage",id:"usage",level:2},{value:"Further Reading",id:"further-reading",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"installing-package-manager",children:"Installing Package Manager"})}),"\n",(0,t.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/sofie-core/docs/user-guide/installation/installing-sofie-server-core",children:"Installed and running Sofie\xa0Core"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/sofie-core/docs/user-guide/installation/initial-sofie-core-setup",children:"Initial Sofie\xa0Core Setup"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/SuperFlyTV/sofie-demo-blueprints",children:"Installed and configured Demo Blueprints"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/sofie-core/docs/user-guide/installation/installing-connections-and-additional-hardware/casparcg-server-installation",children:"Installed, configured, and running CasparCG\xa0Server"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsxs)(n.a,{href:"/sofie-core/docs/user-guide/installation/installing-connections-and-additional-hardware/ffmpeg-installation",children:[(0,t.jsx)(n.code,{children:"FFmpeg"})," and ",(0,t.jsx)(n.code,{children:"FFprobe"})," available in ",(0,t.jsx)(n.code,{children:"PATH"})]})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Package Manager is used by Sofie to copy, analyze, and process media files. It is what powers Sofie's ability to copy media files to playout devices, to know when a media file is ready for playout, and to display details about media files in the rundown view such as scene changes, black frames, freeze frames, and more."}),"\n",(0,t.jsx)(n.p,{children:"Although Package Manager can be used to copy any kind of file to/from a wide array of devices, we'll be focusing on a basic CasparCG\xa0Server Server setup for this guide."}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"Sofie supports only one Package Manager running for a Studio. Attaching more at a time will result in weird behaviour due to them fighting over reporting the statuses of packages.\nIf you feel like you need multiple, then you likely want to run Package Manager in the distributed setup instead."})}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"The Package Manager worker process is primarily tested on Windows only. It does run on Linux (without support for network shares), but has not been extensively tested."})}),"\n",(0,t.jsx)(n.h2,{id:"installation-for-development-quick-start",children:"Installation For Development (Quick Start)"}),"\n",(0,t.jsxs)(n.p,{children:["Package Manager is a suite of standalone applications, separate from ",(0,t.jsx)(n.em,{children:"Sofie\xa0Core"}),". This guide assumes that Package Manager will be running on the same computer as ",(0,t.jsx)(n.em,{children:"CasparCG\xa0Server"})," and ",(0,t.jsx)(n.em,{children:"Sofie\xa0Core"}),", as that is the fastest way to set up a demo. To get all parts of ",(0,t.jsx)(n.em,{children:"Package Manager"})," up and running quickly, execute these commands:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'git clone https://github.com/Sofie-Automation/sofie-package-manager.git\ncd sofie-package-manager\nyarn install\nyarn build\nyarn start:single-app -- -- --basePath "C:\\your\\path\\to\\casparcg-server\\media-folder (i.e. sofie-demo-media)"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note: if Powershell throws ",(0,t.jsx)(n.code,{children:"Unknown argument: basePath"})," error, add one more pair of dashes (",(0,t.jsx)(n.code,{children:"--"}),") before the basePath argument:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'yarn start:single-app -- -- -- --basePath "C:\\your\\path\\to\\casparcg-server\\media-folder (i.e. sofie-demo-media)"\n'})}),"\n",(0,t.jsx)(n.p,{children:"On first startup, Package Manager will exit with the following message:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Not setup yet, exiting process!\nTo setup, go into Core and add this device to a Studio\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This first run is necessary to get the Package Manager device registered with ",(0,t.jsx)(n.em,{children:"Sofie\xa0Core"}),". We'll restart Package Manager later on in the ",(0,t.jsx)(n.a,{href:"#configuration",children:"Configuration"})," instructions."]}),"\n",(0,t.jsx)(n.h2,{id:"installation-in-production",children:"Installation In Production"}),"\n",(0,t.jsx)(n.p,{children:"Only one Package Manager can be running for a Sofie Studio. If you reached this point thinking of deploying multiple, you will want to follow the distributed setup."}),"\n",(0,t.jsx)(n.h3,{id:"simple-setup",children:"Simple Setup"}),"\n",(0,t.jsxs)(n.p,{children:["For setups where you only need to interact with CasparCG on one machine, we provide pre-built executables for Windows (x64) systems. These can be found on the ",(0,t.jsx)(n.a,{href:"https://github.com/Sofie-Automation/sofie-package-manager/releases",children:"Releases"})," GitHub repository page for Package Manager. For a minimal installation, you'll need the ",(0,t.jsx)(n.code,{children:"package-manager-single-app.exe"})," and ",(0,t.jsx)(n.code,{children:"worker.exe"}),". Put them in a folder of your choice. You can also place ",(0,t.jsx)(n.code,{children:"ffmpeg.exe"})," and ",(0,t.jsx)(n.code,{children:"ffprobe.exe"})," alongside them, if you don't want to make them available in ",(0,t.jsx)(n.code,{children:"PATH"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"package-manager-single-app.exe --coreHost=<Core Host Name> --corePort=<Core HTTP(S) port> --deviceId=<Peripheral Device Id> --deviceToken=<Peripheral Device Token/Password>\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Package Manager can be launched from ",(0,t.jsx)(n.a,{href:"/sofie-core/docs/user-guide/installation/installing-connections-and-additional-hardware/casparcg-server-installation#installing-the-casparcg-launcher",children:"CasparCG Launcher"})," alongside Caspar-CG. This will make management and log collection easier on a production Video Server."]}),"\n",(0,t.jsxs)(n.p,{children:["You can see a list of available options by running ",(0,t.jsx)(n.code,{children:"package-manager-single-app.exe --help"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["In some cases, you will need to run the HTTP proxy server component elsewhere so that it can be accessed from your Sofie UI machines.\nFor this, you can run the ",(0,t.jsx)(n.code,{children:"sofietv/package-manager-http-server"})," docker image, which exposes its service on port 8080 and expects ",(0,t.jsx)(n.code,{children:"/data/http-server"})," to be persistent storage.\nWhen configuring the http proxy server in Sofie, you may need to follow extra configuration steps for this to work as expected."]}),"\n",(0,t.jsx)(n.h3,{id:"distributed-setup",children:"Distributed Setup"}),"\n",(0,t.jsx)(n.p,{children:"For setups where you need to interact with multiple CasparCG machines, or want a more resilient/scalable setup, Package Manager can be partially deployed in Docker, with just the workers running on each CasparCG machine."}),"\n",(0,t.jsxs)(n.p,{children:["An example ",(0,t.jsx)(n.code,{children:"docker-compose"})," of the setup is as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"services:\n  # Fix Ownership of HTTP Server\n  # Because docker volumes are owned by root by default\n  # And our images follow best-practise and don't run as root\n  change-vol-ownerships:\n    image: node:22-alpine3.22\n    user: 'root'\n    volumes:\n      - http-server-data:/data/http-server\n    entrypoint: ['sh', '-c', 'chown -R node:node /data/http-server']\n\n  http-server:\n    image: ghcr.io/sofie-automation/sofie-package-manager-http-server:v1.52.0\n    environment:\n      HTTP_SERVER_BASE_PATH: '/data/http-server'\n    ports:\n      - '8080:8080'\n    volumes:\n      - http-server-data:/data/http-server\n    depends_on:\n      change-vol-ownerships:\n        condition: service_completed_successfully\n\n  workforce:\n    image: ghcr.io/sofie-automation/sofie-package-manager-workforce:v1.52.0\n    ports:\n      - '8070:8070' # this needs to be exposed so that the workers can connect back to it\n    # environment:\n    #   - WORKFORCE_ALLOW_NO_APP_CONTAINERS=1 # Uncomment this if your workers are in docker, to disable the check for no appContainers\n\n  # You can deploy workers in docker too, which requires some additional configuration of your containers.\n  # This does not support FILESHARE accessors, they must be explicitly mounted as volumes\n  # You will likely want to deploy more than 1 worker\n  # worker0:\n  #   image: ghcr.io/sofie-automation/sofie-package-manager-worker:v1.52.0\n  #   command:\n  #     - --logLevel=debug\n  #     - --workforceURL=ws://workforce:8070\n  #     - --costMultiplier=0.5\n  #     - --resourceId=docker\n  #     - --networkIds=networkDocker\n  #   volumes:\n  #     - ./media-source:/data/source:ro\n\n  package-manager:\n    depends_on:\n      - http-server\n      - workforce\n    image: ghcr.io/sofie-automation/sofie-package-manager-package-manager:v1.52.0\n    environment:\n      CORE_HOST: '172.18.0.1' # the address for connecting back to Sofie core from this image\n      CORE_PORT: '3000'\n      DEVICE_ID: 'my-package-manager-id'\n      DEVICE_TOKEN: 'some-secret'\n      WORKFORCE_URL: 'ws://workforce:8070' # referencing the workforce component above\n      PACKAGE_MANAGER_PORT: '8060'\n      PACKAGE_MANAGER_URL: 'ws://insert-service-ip-here:8060' # the workers connect back to this address, so it needs to be accessible from the workers\n      # CONCURRENCY: 10 # How many expectation states can be evaluated at the same time\n    ports:\n      - '8060:8060'\n\nnetworks:\n  default:\nvolumes:\n  http-server-data:\n"})}),"\n",(0,t.jsx)(n.p,{children:"In addition to this, you will need to run the appContainer and workers on each windows machine that package-manager needs access to:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"./appContainer-node.exe\n  --appContainerId=caspar01 // This is a unique id for this instance of the appContainer\n  --workforceURL=ws://workforce-service-ip:8070\n  --resourceId=caspar01 // This should also be set in the 'resource id' field of the `casparcgLocalFolder1` accessor. This is how Package Manager can identify which machine is which.\n  --networkIds=pm-net // This is not necessary, but can be useful for more complex setups\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can get the windows executables from ",(0,t.jsx)(n.a,{href:"https://github.com/Sofie-Automation/sofie-package-manager/releases",children:"Releases"})," GitHub repository page for Package Manager. You'll need the ",(0,t.jsx)(n.code,{children:"appContainer-node.exe"})," and ",(0,t.jsx)(n.code,{children:"worker.exe"}),". Put them in a folder of your choice. You can also place ",(0,t.jsx)(n.code,{children:"ffmpeg.exe"})," and ",(0,t.jsx)(n.code,{children:"ffprobe.exe"})," alongside them, if you don't want to make them available in ",(0,t.jsx)(n.code,{children:"PATH"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Note that each appContainer needs to use a different resourceId and will need its own package containers set to use the same resourceIds if they need to access the local disk. This is how package-manager knows which workers have access to which machines."}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Open the ",(0,t.jsx)(n.em,{children:"Sofie\xa0Core"})," Settings page (",(0,t.jsx)(n.a,{href:"http://localhost:3000/settings?admin=1",children:"http://localhost:3000/settings?admin=1"}),"), click on your Studio, and then Peripheral Devices."]}),"\n",(0,t.jsxs)(n.li,{children:["Click the plus button (",(0,t.jsx)(n.code,{children:"+"}),") in the Parent Devices section and configure the created device to be for your Package Manager."]}),"\n",(0,t.jsx)(n.li,{children:"On the sidebar under the current Studio, select to the Package Manager section."}),"\n",(0,t.jsx)(n.li,{children:"Click the plus button under the Package Containers heading, then click the edit icon (pencil) to the right of the newly-created package container."}),"\n",(0,t.jsxs)(n.li,{children:["Give this package container an ID of ",(0,t.jsx)(n.code,{children:"casparcgContainer0"})," and a label of ",(0,t.jsx)(n.code,{children:"CasparCG Package Container"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:['Click on the dropdown under "Playout devices which use this package container" and select ',(0,t.jsx)(n.code,{children:"casparcg0"}),".","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["If you don't have a ",(0,t.jsx)(n.code,{children:"casparcg0"})," device, add it to the Playout Gateway under the Devices heading, then restart the Playout Gateway."]}),"\n",(0,t.jsxs)(n.li,{children:["If you are using the distributed setup, you will likely want to repeat this step for each CasparCG machine. You will also want to set ",(0,t.jsx)(n.code,{children:"Resource Id"})," to match the ",(0,t.jsx)(n.code,{children:"resourceId"})," value provided in the appContainer command line."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:'Click the plus button under "Accessors", then click the edit icon to the right of the newly-created accessor.'}),"\n",(0,t.jsxs)(n.li,{children:["Give this accessor an ID of ",(0,t.jsx)(n.code,{children:"casparcgHttpProxy0"}),", a Label of ",(0,t.jsx)(n.code,{children:"CasparCG HTTP Proxy Accessor"}),", an Accessor Type of ",(0,t.jsx)(n.code,{children:"HTTP_PROXY"}),", and a Base URL of ",(0,t.jsx)(n.code,{children:"http://localhost:8080/package"}),'. Then, ensure that both the "Allow Read access" and "Allow Write access" boxes are checked. Finally, click the done button (checkmark icon) in the bottom right.']}),"\n",(0,t.jsx)(n.li,{children:'Scroll back to the top of the page and select "CasparCG Package Container" for both "Package Containers to use for previews" and "Package Containers to use for thumbnails".'}),"\n",(0,t.jsxs)(n.li,{children:["Your settings should look like this once all the above steps have been completed:\n",(0,t.jsx)(n.img,{alt:"Package Manager demo settings",src:a(64773).A+"",width:"1776",height:"1257"})]}),"\n",(0,t.jsxs)(n.li,{children:["If Package Manager ",(0,t.jsx)(n.code,{children:"start:single-app"})," is running, restart it. If not, start it (see the above ",(0,t.jsx)(n.a,{href:"#installation-quick-start",children:"Installation instructions"})," for the relevant command line)."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"separate-http-proxy-server",children:"Separate HTTP proxy server"}),"\n",(0,t.jsx)(n.p,{children:"In some setups, the URL of the HTTP proxy server is different when accessing the Sofie UI and Package Manager.\nYou can use the 'Network ID' concept in Package Manager to provide guidance on which to use when."}),"\n",(0,t.jsxs)(n.p,{children:["By adding ",(0,t.jsx)(n.code,{children:"--networkIds=pm-net"})," (a semi colon separated list) when launching the exes on the CasparCG machine, the application will know to prefer certain accessors with matching values."]}),"\n",(0,t.jsx)(n.p,{children:"Then in the Sofie UI:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Return to the Package Manager settings under the studio"}),"\n",(0,t.jsxs)(n.li,{children:["Expand the ",(0,t.jsx)(n.code,{children:"casparcgContainer"})," container."]}),"\n",(0,t.jsxs)(n.li,{children:["Edit the ",(0,t.jsx)(n.code,{children:"casparcgHttpProxy"})," accessor to have a ",(0,t.jsx)(n.code,{children:"Base URL"})," that is accessible from the casparcg machines."]}),"\n",(0,t.jsxs)(n.li,{children:["Set the ",(0,t.jsx)(n.code,{children:"Network ID"})," to ",(0,t.jsx)(n.code,{children:"pm-net"})," (matching what was passed in the command line)"]}),"\n",(0,t.jsx)(n.li,{children:'Click the plus button under "Accessors", then click the edit icon to the right of the newly-created accessor.'}),"\n",(0,t.jsxs)(n.li,{children:["Give this accessor an ID of ",(0,t.jsx)(n.code,{children:"casparcgHttpProxyThumbnails0"}),", a Label of ",(0,t.jsx)(n.code,{children:"CasparCG Thumbnail HTTP Proxy Accessor"}),", an Accessor Type of ",(0,t.jsx)(n.code,{children:"HTTP_PROXY"}),', and a Base URL that is accessible to your Sofie client network. Then, ensure that only the "Allow Write access" box is checked. Finally, click the done button (checkmark icon) in the bottom right.']}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(n.p,{children:"In this basic configuration, Package Manager won't be copying any packages into your CasparCG\xa0Server media folder. Instead, it will simply check that the files in the rundown are present in your CasparCG\xa0Server media folder, and you'll have to manually place those files in the correct directory. However, thumbnail and preview generation will still function, as will status reporting."}),"\n",(0,t.jsxs)(n.p,{children:["If you're using the demo rundown provided by the ",(0,t.jsx)(n.a,{href:"/sofie-core/docs/user-guide/installation/rundown-editor",children:"Rundown Editor"}),", you should already see work statuses on the Package Status page (",(0,t.jsx)(n.a,{href:"http://localhost:3000/status/expected-packages",children:"Status > Packages"}),")."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Example Package Manager status display",src:a(70621).A+"",width:"776",height:"905"})}),"\n",(0,t.jsxs)(n.p,{children:["If all is good, head to the ",(0,t.jsx)(n.a,{href:"http://localhost:3000/rundowns",children:"Rundowns page"})," and open the demo rundown."]}),"\n",(0,t.jsx)(n.h3,{id:"further-reading",children:"Further Reading"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/Sofie-Automation/sofie-package-manager",children:"Package Manager"})," on GitHub."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},64773:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Package_Manager_demo_settings-19d627ac6747569e7b42951f000c8854.png"},70621:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Package_Manager_status_example-1119a18c13b3c5d8bfc36be2d06948b6.jpg"},43023:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>r});var i=a(63696);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);